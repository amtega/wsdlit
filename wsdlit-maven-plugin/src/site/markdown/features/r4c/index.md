<!--
  #%L
  AMTEGA WsdlIT Maven Plugin
  %%
  Copyright (C) 2021 - 2022 Axencia para a Modernización Tecnolóxica de Galicia (AMTEGA) - Xunta de Galicia
  %%
  This file is part of "wsdlit".
  
  "wsdlit" is free software: you can redistribute it and/or modify
  it under the terms of:
  European Union Public License, either Version 1.2 or – as soon
  they will be approved by the European Commission - subsequent versions of
  the EUPL;
  
  "wsdlit" is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  European Union Public License for more details.
  
  You may obtain a copy of tce European Union Public Licence at:
  http://joinup.ec.europa.eu/software/page/eupl/licence-eupl
  #L%
  -->

# Resources for Consumers (r4c)

**Resources for Consumers** (r4c) is nothing more than a concept created to distribute and refer to in an easy way
to a packaging of service contracts suitable for use by `wsdlit-maven-plugin`,
and by the consumers themselves in the development projects in which the services need to be consumed.

The packaging currently supported by `wsdlit` is `packaging=zip`.
In projects that use `wsdlit` in Emprego we add the `classifier=r4c` to facilitate certain internal operations in our systems.

---
**Table of Contents**
<!-- MACRO{toc} -->
---

## Layout

The structure of files and directories that will be respected when packaging the `r4c` will be as follows:

```
/
|- wsdlit (1)
| |- artifactId (2)
| | |- endpoints (3)
| | | |- index.adoc (4)
| | |- examples (3)
| | | |- index.adoc (4)
| | |- links (3)
| | | |- index.adoc (4)
|- wsdls (5)
| | |- contract.wsdl (6)
| | |- contract.xsd (7)
| | | |- xsd (8)
| | | | |- external_service_1 (9)
| | | | | |- external-xsd1.xsd (10)
| | | | | |- external-xsd2.xsd (10)
```

1. `wsdlit`: Directory to store the additional documentation.
   Its content is **optional**.
2. `artifactId`: The value of the `artifactId` into which the contract was packaged.
3. `endpoints`, `examples` and `links`: Additional documentation.
4. `index.adoc`: The main file of the additional documentation.
5. `wsdls`: Directory to host the service contract.
6. `contract.wsdl`: The `wsdl` that defines the service contract.
7. `contract.xsd`: A hypothetical `xsd` required by the `wsdl`.
   Its content is **optional**.
8. `xsd`: Directory to store the additional data schemas,
   for example,
   those defined in a core.
9. `external_service_1`: We separate the files by service.
   The directory name value is the value of the `name` attribute of the external service contract.
10. `external-xsd1.xsd` and `external-xsd2.xsd`: `xsd` files of service `external_service_1`.

## The directory to which the relevant content of the remote R4Cs is copied

When downloading **r4c** artifacts is specified in the plugin configuration,
`wsdlit` attempts to download and unzip the relevant content to a directory.
The name of the directory in which its contents are extracted becomes relevant during the development process,
in which before uploading the changes to the **SCM** the documentation is generated by patching the contracts,
since the directory where the patch files and directories will be copied for each service must match the directory
in which the remotes are unzipped.

That is why it is necessary to take into account how the name of the directory in which the files with the patches will be placed is calculated:

1. We start from the value of the `artifactId` of the artifact.
2. The following characters are retained (deleting the rest):
   * Letters (a-z, A-Z).
   * Numbers (0-9).
   * **_** (underline character).
   * **.** (the point).
   * **-** (the script).
3. **_**, **.** and/or **-** characters at the end of the resulting text are removed.

Here are several examples of directory name calculation:

| artifactId | Directory         |
|------------------|-------------------|
| `artifact-id` | `artifact-id`     |
| `artifact-id-4` | `artifact-id-4`   |
| `artifact-id_` | `artifact-id`     |
| `artifact-id_-_` | `artifact-id`     |

## FAQ

### Why package the contracts into a new file?

Packaging into a new archive is done for several reasons:

* It is necessary that the service contracts respond to a uniform structure, convention rather than configuration.
* Consumers of the service will be able to download a file with a standard structure in which they will obtain the same contracts.
* For security reasons, consumers of the service cannot be supplied with the `jar` or `war` to be deployed to the backend.

### Why is the contract directory separated from the additional information directory?

For a practical matter. Each directory is designed to fulfill a purpose.

* `wsdlit`: add documentation to the one automatically generated from the content of the contract.
* `wsdls`: copy its contents to the project in which the service is intended to be consumed.

### Does wsdlit support other packaging than `zip`?

Currently the only packaging supported by `wsdlit` is `zip`.
It's a design decision, again convention rather than configuration,
to avoid the need to code different types of unpacking,
one for each type supported,
and prevent consumers from being forced to deal with different types of packaging.